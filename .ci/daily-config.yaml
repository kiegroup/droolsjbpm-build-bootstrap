version: "2.1"

dependencies: ./project-dependencies.yaml

pre: |
  export MAVEN_COMMAND=mvn -B -e -U clean deploy -Dfull -Drelease -DaltDeploymentRepository=local::default::file://$WORKSPACE/deploy-dir -Dmaven.test.redirectTestOutputToFile=true -Dmaven.test.failure.ignore=true -Dgwt.memory.settings="-Xmx10g" -Prun-code-coverage  -Dcontainer.profile=wildfly -Dcontainer=wildfly -Dintegration-tests=true -Dmaven.wagon.httpconnectionManager.ttlSeconds=25 -Dmaven.wagon.http.retryHandler.count=3 --clean-up-script="$WORKSPACE/clean-up.sh"
  echo "MAVEN_COMMAND=${{ env.MAVEN_COMMAND }}"

default:
  build-command:
    current: ${{ env.MAVEN_COMMAND }}

build:
  - project: mbiarnes/droolsjbpm-build-bootstrap
    build-command:
      before:
        current: |
          ./script/release/03_upgradeVersions.sh $JDK_VERSION
          ./script/release/eraseM2.sh $m2Dir
      current: ${{ env.MAVEN_COMMAND }} 
